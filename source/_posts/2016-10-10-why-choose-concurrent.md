title: 为什么我们要考虑并发
date: 2016-10-10 06:58:03
categories: java并发
tags: [并发,上下文切换,效率]
---
在Java中使用并发，不是单纯的为了并发而并发。最初的想法是多线程执行肯定比单线程快，就像多个人一块干活要比一个人快。事实比想象的要复杂，让我们把视角缩放到CPU层级，细致观察一下并发的时候CPU在做什么样的事情。
<!--more-->

“很显然嘛，并发可以提升效率”
事实果真如此吗？
CPU的计算操作所需时间在纳秒级别，而I/O操作（包括CPU一级缓存、二级缓存、三级缓存、内存、磁盘和网络）则不同，例如一级缓存的相应时间在纳秒级别，而磁盘读取文件的响应时间在毫秒级别，前者较后者相比快5-6个数量级。CPU就像疾如闪电的快银（漫威动画），而硬盘则是一个慢吞吞的蜗牛，可以想想这种毫无默契的违和感。如果这两位在一起工作，而且CPU必须I/O操作完成后才进行后续的操作，这对于CPU是一种煎熬，更是一种资源的巨大浪费。
智慧的前辈已经想到这点了，所以引入了并发编程，引入了上下文切换，提高资源的利用率，降低整体的相应时间，避免CPU这种宝贵且昂贵（对比一下你组装电脑时CPU的价格和内存条的价格）的资源浪费。
没了吗？这不是很完美吗？
不仅仅是这些。
## 上下文切换

## 计算密集型和I/O密集型

## 抉择
很荣幸，一般的任务都是既有CPU计算，又有I/O，还有网络，这就是木桶原理，有一块短板，就会拖慢整个过程。那么CPU在这大把的空闲时间内该如何做呢？很显然通过并发编程的方式提升性能，降低相应时间。